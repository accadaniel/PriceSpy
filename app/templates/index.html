{% extends "base.html" %}

{% block title %}Products - PriceSpy{% endblock %}

{% block content %}
<h2 style="margin-bottom: 20px;">Tracked Products</h2>

{% if products %}
<div class="products-grid">
    {% for product in products %}
    <div class="card product-card {% if not product.is_active %}inactive{% endif %}">
        {% if product.lowest_price and product.lowest_price < product.target_price %}
        <span class="badge badge-deal">DEAL!</span>
        {% elif not product.is_active %}
        <span class="badge badge-inactive">Paused</span>
        {% endif %}

        <h3>{{ product.name }}</h3>

        <div class="meta">
            <div>Search: {{ product.search_query }}</div>
            {% if product.size %}<div>Size: {{ product.size }}</div>{% endif %}
            {% if product.color %}<div>Color: {{ product.color }}</div>{% endif %}
        </div>

        <div class="price-info">
            <div>
                {% if product.lowest_price %}
                <div class="current-price">${{ "%.2f"|format(product.lowest_price) }}</div>
                <div class="retailer">at {{ product.lowest_price_retailer }}</div>
                {% else %}
                <div class="current-price">No prices yet</div>
                {% endif %}
            </div>
            <div class="target-price">
                Target: ${{ "%.2f"|format(product.target_price) }}
            </div>
        </div>

        <div class="actions">
            <a href="/product/{{ product.id }}" class="btn btn-primary btn-sm">View Details</a>
            <form action="/product/{{ product.id }}/toggle" method="post" style="display:inline;">
                <button type="submit" class="btn btn-secondary btn-sm">
                    {{ "Activate" if not product.is_active else "Pause" }}
                </button>
            </form>
            <form action="/product/{{ product.id }}/delete" method="post" style="display:inline;"
                  onsubmit="return confirm('Delete this product?');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state card">
    <h2>No products yet</h2>
    <p>Start tracking prices by adding your first product.</p>
    <a href="/add" class="btn btn-primary" style="margin-top: 20px;">+ Add Product</a>
</div>
{% endif %}
{% endblock %}
